---
# Source: clickhouse-cluster/templates/cluster.yaml
apiVersion: apps.kubeblocks.io/v1
kind: Cluster
metadata:
  name: cluster-tls
  namespace: default
spec:
  terminationPolicy: Delete
  clusterDef: clickhouse
  topology: cluster
  componentSpecs:
    - name: ch-keeper
      replicas: 1
      configs:
        - name: clickhouse-keeper-tpl
          externalManaged: true
      resources:
        limits:
          cpu: "1"
          memory: "2Gi"
        requests:
          cpu: "1"
          memory: "2Gi"
      systemAccounts:
        - name: admin
          passwordConfig:
            length: 10
            numDigits: 5
            numSymbols: 0
            letterCase: MixedCases
            seed: cluster-tls
      volumeClaimTemplates:
        - name: data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 10Gi
    - name: clickhouse
      replicas: 2
      configs:
        - name: clickhouse-tpl
          externalManaged: true
        - name: clickhouse-user-tpl
          externalManaged: true
        - name: clickhouse-client-tpl
          externalManaged: true
      systemAccounts:
        - name: admin
          passwordConfig:
            length: 10
            numDigits: 5
            numSymbols: 0
            letterCase: MixedCases
            seed: cluster-tls
      resources:
        limits:
          cpu: "1"
          memory: "2Gi"
        requests:
          cpu: "1"
          memory: "2Gi"
      volumeClaimTemplates:
        - name: data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
      tls: true   # set TLS to true
      issuer:     # if TLS is True, this filed is required.
        name: KubeBlocks  # set Issuer to [KubeBlocks, UserProvided].
        # name: UserProvided  # set Issuer to [KubeBlocks, UserProvided].
        # secretRef: secret-name # if name=UserProvided, must set the reference to the secret that contains user-provided certificates
