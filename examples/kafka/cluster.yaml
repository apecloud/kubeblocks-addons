apiVersion: apps.kubeblocks.io/v1alpha1
kind: Cluster
metadata:
  name: kafka-cluster
  annotations:
    "kubeblocks.io/extra-env": '{"KB_KAFKA_ENABLE_SASL":"false","KB_KAFKA_BROKER_HEAP":"-XshowSettings:vm -XX:MaxRAMPercentage=100 -Ddepth=64","KB_KAFKA_CONTROLLER_HEAP":"-XshowSettings:vm -XX:MaxRAMPercentage=100 -Ddepth=64","KB_KAFKA_PUBLIC_ACCESS":"false"}'
spec:
  clusterDefinitionRef: kafka
  terminationPolicy: Delete  
  affinity:
    podAntiAffinity: Preferred
    topologyKeys:
      - kubernetes.io/hostname
    tenancy: SharedNode
  topology:  combined_monitor
  componentSpecs:
    - name: kafka-combine
      tls: false
      replicas: 1
      monitor: true
      serviceAccountName: 
      monitor: true
      services:
        - name: advertised-listener
          serviceType: ClusterIP
          podService: true
      resources:
        limits:
          cpu: "0.5"
          memory: "0.5Gi"
        requests:
          cpu: "0.5"
          memory: "0.5Gi"
      env:
        - name: KB_BROKER_DIRECT_POD_ACCESS
          value: "false"
        # currently only valid for broker
        - name: KB_KAFKA_ENABLE_SASL_SCRAM
          value: "false"
      volumeClaimTemplates:
        - name: data
          spec:
            storageClassName: 
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 10Gi
        - name: metadata
          spec:
            storageClassName: 
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 5Gi
    - name: kafka-exporter
      replicas: 1
      monitor: true
      env:
        - name: KB_KAFKA_ENABLE_SASL_SCRAM
          value: "false"
      
      resources:
        limits:
          cpu: "0.5"
          memory: "1Gi"
        requests:
          cpu: "0.1"
          memory: "0.25Gi"
