{
  "$schema": "http://json-schema.org/schema#",
  "type": "object",
  "title": "TiDB Cluster Configuration",
  "description": "Configuration schema for the TiDB cluster Helm chart.",
  "properties": {
    "pd": {
      "type": "object",
      "properties": {
        "replicas": {
          "type": "integer",
          "default": 3,
          "description": "Number of PD replicas. Must be an odd number for consensus.",
          "minimum": 1,
          "not": {
            "multipleOf": 2
          }
        },
        "resources": {
          "type": "object",
          "properties": {
            "limits": {
              "type": "object",
              "properties": {
                "cpu": {
                  "title": "CPU limit",
                  "description": "CPU limit",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 2,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                },
                "memory": {
                  "title": "Memory limit(Gi)",
                  "description": "Memory limit, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 8,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            },
            "requests": {
              "type": "object",
              "properties": {
                "cpu": {
                  "title": "CPU request",
                  "description": "CPU request",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 2,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                },
                "memory": {
                  "title": "Memory request(Gi)",
                  "description": "Memory request, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 8,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "properties": {
                "storageClassName": {
                  "title": "Storage Class Name",
                  "description": "Storage class name for persistent volumes.",
                  "type": ["string", "null"],
                  "default": null
                },
                "size": {
                  "title": "Size of persistent volume claim(Gi)",
                  "description": "Size of persistent volume claim, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 20,
                  "minimum": 1,
                  "maximum": 10000,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            }
          }
        },
        "tolerations": {
          "type": "array",
          "items": {},
          "default": [],
          "description": "Tolerations for PD pod assignment."
        }
      }
    },
    "tikv": {
      "type": "object",
      "properties": {
        "replicas": {
          "type": "integer",
          "default": 3,
          "description": "Number of TiKV replicas. Must be an odd number for consensus.",
          "minimum": 1
        },
        "resources": {
          "type": "object",
          "properties": {
            "limits": {
              "type": "object",
              "properties": {
                "cpu": {
                  "title": "CPU limit",
                  "description": "CPU limit",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 4,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                },
                "memory": {
                  "title": "Memory limit(Gi)",
                  "description": "Memory limit, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 16,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            },
            "requests": {
              "type": "object",
              "properties": {
                "cpu": {
                  "title": "CPU request",
                  "description": "CPU request",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 4,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                },
                "memory": {
                  "title": "Memory request(Gi)",
                  "description": "Memory request, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 16,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "properties": {
                "storageClassName": {
                  "title": "Storage Class Name",
                  "description": "Storage class name for persistent volumes.",
                  "type": ["string", "null"],
                  "default": null
                },
                "size": {
                  "title": "Size of persistent volume claim(Gi)",
                  "description": "Size of persistent volume claim, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 500,
                  "minimum": 1,
                  "maximum": 10000,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            }
          }
        },
        "tolerations": {
          "type": "array",
          "items": {},
          "default": [],
          "description": "Tolerations for TiKV pod assignment."
        }
      }
    },
    "tidb": {
      "type": "object",
      "properties": {
        "replicas": {
          "type": "integer",
          "default": 2,
          "description": "Number of TiDB replicas.",
          "minimum": 1
        },
        "resources": {
          "type": "object",
          "properties": {
            "limits": {
              "type": "object",
              "properties": {
                "cpu": {
                  "title": "CPU limit",
                  "description": "CPU limit",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 4,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                },
                "memory": {
                  "title": "Memory limit(Gi)",
                  "description": "Memory limit, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 16,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            },
            "requests": {
              "type": "object",
              "properties": {
                "cpu": {
                  "title": "CPU request",
                  "description": "CPU request",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 4,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                },
                "memory": {
                  "title": "Memory request(Gi)",
                  "description": "Memory request, the unit is Gi.",
                  "type": [
                    "number",
                    "string"
                  ],
                  "default": 16,
                  "minimum": 1,
                  "pattern": "^[0-9]+(\\.[0-9]+)?$"
                }
              }
            }
          }
        }
      }
    }
  },
  "required": ["pd", "tikv", "tidb"]
}