{{- if .Values.extra.enableTLSBetweenComponents }}
{{- $ca := genCA "KubeBlocks" 36500 }}
{{- $domain := printf "%s-tidb-pd-headless.default.svc.cluster.local" ( include "kblib.clusterName" . ) }}
{{- $wildcardDoamin := printf "*.%s" $domain}}
{{- $cert := genSignedCert "tidb" (list "127.0.0.1" "::1") (list "localhost" $domain $wildcardDoamin) 36500 $ca }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "tidb-cluster.TLSBetweenComponentsSecretName" . }}
  namespace: {{ .Release.Namespace | quote }}
  labels: {{- include "tidb-cluster.labels" . | nindent 4 }}
type: Opaque
stringData:
  ca.pem: {{ $ca.Cert | quote }}
  cert.pem: {{ $cert.Cert | quote }}
  key.pem: {{ $cert.Key | quote }}
{{- end }}
