apiVersion: apps.kubeblocks.io/v1
kind: Cluster
metadata:
  namespace: {{ .Release.Namespace }}
  name: {{ include "kblib.clusterName" . }}
  labels: {{ include "kblib.clusterLabels" . | nindent 4 }}
spec:
  terminationPolicy: {{ .Values.terminationPolicy | quote }}
  clusterDef: {{ .Values.clusterDef | quote }}
  topology: {{ .Values.topology | quote }}
  componentSpecs:
    - name: zookeeper
      componentDef: zookeeper
      serviceVersion: {{ .Values.zookeeperServiceVersion }}
      replicas: {{ .Values.replicas.zookeeper }}
      resources:
        requests:
          cpu: {{ .Values.resources.zookeeper.requests.cpu | quote }}
          memory: {{ .Values.resources.zookeeper.requests.memory }}
        limits:
          cpu: {{ .Values.resources.zookeeper.limits.cpu | quote }}
          memory: {{ .Values.resources.zookeeper.limits.memory }}
      volumeClaimTemplates:
        - name: data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: {{ .Values.storage.zookeeper }}
        - name: snapshot-log
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: {{ .Values.storage.zookeeper }}
    - name: thrift
      componentDef: hbase-thrift
      serviceVersion: 2.5.12
      replicas: {{ .Values.replicas.thrift }}
      env:
        - name: "HADOOP_CLUSTER_NAME"
          value: {{ .Values.hadoopCluster.name }}
      resources:
        requests:
          cpu: {{ .Values.resources.thrift.requests.cpu | quote }}
          memory: {{ .Values.resources.thrift.requests.memory }}
        limits:
          cpu: {{ .Values.resources.thrift.limits.cpu | quote }}
          memory: {{ .Values.resources.thrift.limits.memory }}
      volumes:
        - name: hadoop-core-config
          configMap:
            name: {{  .Values.hadoopCluster.name }}-journalnode-core-config
        - name: hadoop-hdfs-config
          configMap:
            name: {{ .Values.hadoopCluster.name }}-namenode-config
    - name: hmaster
      componentDef: hbase-hmaster
      serviceVersion: 2.5.12
      replicas: {{ .Values.replicas.hmaster }}
      env:
        - name: "HADOOP_CLUSTER_NAME"
          value: {{ .Values.hadoopCluster.name }}
      resources:
        requests:
          cpu: {{ .Values.resources.hmaster.requests.cpu | quote }}
          memory: {{ .Values.resources.hmaster.requests.memory }}
        limits:
          cpu: {{ .Values.resources.hmaster.limits.cpu | quote }}
          memory: {{ .Values.resources.hmaster.limits.memory }}
      volumes:
        - name: hadoop-core-config
          configMap:
            name: {{  .Values.hadoopCluster.name }}-journalnode-core-config
        - name: hadoop-hdfs-config
          configMap:
            name: {{ .Values.hadoopCluster.name }}-namenode-config
      volumeClaimTemplates:
        - name: hbase-log
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: {{ .Values.storage.hbaseLog }}

    - name: hregionserver
      componentDef: hbase-hregionserver
      serviceVersion: 2.5.12
      replicas: {{ .Values.replicas.hregionserver }}
      env:
        - name: "HADOOP_CLUSTER_NAME"
          value: {{ .Values.hadoopCluster.name }}
      resources:
        requests:
          cpu: {{ .Values.resources.hregionserver.requests.cpu | quote }}
          memory: {{ .Values.resources.hregionserver.requests.memory }}
        limits:
          cpu: {{ .Values.resources.hregionserver.limits.cpu | quote }}
          memory: {{ .Values.resources.hregionserver.limits.memory }}
      volumes:
        - name: hadoop-core-config
          configMap:
            name: {{ .Values.hadoopCluster.name }}-journalnode-core-config
        - name: hadoop-hdfs-config
          configMap:
            name: {{ .Values.hadoopCluster.name }}-namenode-config
      volumeClaimTemplates:
        - name: hbase-temp-data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: {{ .Values.storage.hbaseTempData }}
