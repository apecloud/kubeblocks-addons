# Default values for Kafka.

nameOverride: ""

fullnameOverride: ""

## @param commonLabels Labels to add to all deployed objects
##
commonLabels: {}

## @param commonLabels Annotations to add to all deployed objects
commonAnnotations: {}

## @param application images
##
images:
  registry: docker.io
  pullPolicy: IfNotPresent
  kafka:
    repository: bitnami/kafka
#    tag: 3.4.0-debian-11-r22
    tag: 3.3.2-debian-11-r54
  kafka2:
    tag: 2.7.0-debian-10-r124
  kafkaExporter:
    repository: bitnami/kafka-exporter
    tag: 1.6.0-debian-11-r67
  jmxExporter:
    repository: bitnami/jmx-exporter
    tag: 0.18.0-debian-11-r20

## @param define default serviceVersion of each Component
defaultServiceVersion:
  combine: 3.3.2
  controller: 3.3.2
  broker: 3.3.2
  exporter: 1.6.0

## @param define default kafka2 serviceVersion of each Component
defaultKafka2ServiceVersion:
  broker: 2.7.0

## @param debugEnabled enables containers' debug logging
##
debugEnabled: true

kafkaBroker:
  minNodeId: 100

## @param mountOptions set the storageclass mountOptions attributes
##
mountOptions:
  - noatime
  - nobarrier

## storageclass parameters settings
##
## @param storageClassParameters.metadata.awsEBSVolumeType
## @param storageClassParameters.metadata.awsEBSEnableBlockExpress
storageClassParameters:
  install: false
  ## storageclass for KRaft metadata
  ##
  metadata:
    awsEBSVolumeType: io2
    awsEBSEnableBlockExpress: false

## pod security context settings
securityContext:
  fsGroup: 1001

## container security context settings
container:
  securityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 1001

## exporter security context settings
exporter:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1001

## extra volumeMounts for containers
## you can use this values for additional volumeMount like log-path,config-path etc
## example:
##
## extraVolumeMounts:
##   kafka:
##     - name: log-mount-path
##       mountPath: /docker/logs/kfk27-external/
##       subPathExpr: $(POD_UUID)
##     - name: cmdb-conf
##       mountPath: /conf/cmdb.ini
extraVolumeMounts:
  ## apply to all kafka container, include broker/controller/combine.
  kafka: []

## extra Envs for containers
## you can use this values for additional envs which extraVolumeMounts needed, like `subPathExpr`
## example:
##
## extraEnvs:
##   kafka:
##     - name: POD_UUID
##       valueFrom:
##         fieldRef:
##           fieldPath: metadata.uid
extraEnvs:
  ## apply to all kafka container, include broker/controller/combine.
  kafka: []
  ## apply to all jmx-exporter container
  jmxExporter: []

## customize jmx-exporter's port exposed
jmxExporter:
  port: 5556
  jmxKafkaPrometheusYml: |-
    jmxUrl: service:jmx:rmi:///jndi/rmi://127.0.0.1:5555/jmxrmi
    lowercaseOutputName: true
    lowercaseOutputLabelNames: true
    ssl: false
    whitelistObjectNames: ["kafka.controller:*","kafka.server:*","java.lang:*","kafka.network:*","kafka.log:*"]
    rules:
      - pattern: kafka.controller<type=(ControllerChannelManager), name=(QueueSize), broker-id=(\d+)><>(Value)
        name: kafka_controller_$1_$2_$4
        labels:
          broker_id: "$3"
      - pattern: kafka.controller<type=(ControllerChannelManager), name=(TotalQueueSize)><>(Value)
        name: kafka_controller_$1_$2_$3
      - pattern: kafka.controller<type=(KafkaController), name=(.+)><>(Value)
        name: kafka_controller_$1_$2_$3
      - pattern: kafka.controller<type=(ControllerStats), name=(.+)><>(Count)
        name: kafka_controller_$1_$2_$3
      - pattern: kafka.server<type=(ReplicaFetcherManager), name=(.+), clientId=(.+)><>(Value)
        name: kafka_server_$1_$2_$4
        labels:
          client_id: "$3"
      - pattern : kafka.network<type=(Processor), name=(IdlePercent), networkProcessor=(.+)><>(Value)
        name: kafka_network_$1_$2_$4
        labels:
          network_processor: $3
      - pattern : kafka.network<type=(RequestMetrics), name=(RequestsPerSec), request=(.+)><>(Count)
        name: kafka_network_$1_$2_$4
        labels:
          request: $3
      - pattern: kafka.server<type=(.+), name=(.+), topic=(.+)><>(Count|OneMinuteRate)
        name: kafka_server_$1_$2_$4
        labels:
          topic: $3
      - pattern: kafka.server<type=(DelayedOperationPurgatory), name=(.+), delayedOperation=(.+)><>(Value)
        name: kafka_server_$1_$2_$3_$4
      - pattern: kafka.server<type=(.+), name=(.+)><>(Count|Value|OneMinuteRate)
        name: kafka_server_$1_total_$2_$3
      - pattern: kafka.server<type=(.+)><>(queue-size)
        name: kafka_server_$1_$2
      - pattern: java.lang<type=(.+), name=(.+)><(.+)>(\w+)
        name: java_lang_$1_$4_$3_$2
      - pattern: java.lang<type=(.+), name=(.+)><>(\w+)
        name: java_lang_$1_$3_$2
      - pattern : java.lang<type=(.*)>
      - pattern: kafka.log<type=(.+), name=(.+), topic=(.+), partition=(.+)><>Value
        name: kafka_log_$1_$2
        labels:
          topic: $3
          partition: $4
      - pattern: kafka.server<type=socket-server-metrics, listener=(.+), networkProcessor=(.+)><>(connection-count)
        name: kafka_server_socket_server_metrics_$3
        labels:
          listener: $1
