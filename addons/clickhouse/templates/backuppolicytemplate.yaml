apiVersion: apps.kubeblocks.io/v1alpha1
kind: BackupPolicyTemplate
metadata:
  name: clickhouse-backup-policy-template
  labels:
    clusterdefinition.kubeblocks.io/name: clickhouse
    service-kind/clickhouse: "true"
  annotations:
    dataprotection.kubeblocks.io/is-default-policy-template: "true"
spec:
  clusterDefinitionRef: clickhouse
  backupPolicies:
    - componentDefs:
        - clickhouse-24
      target:
        account: admin
        role: ""
        strategy: Any
        useParentSelectedPods: true
      backupMethods:
        - name: full
          snapshotVolumes: false
          actionSetName: clickhouse-full-backup
          targetVolumes:
            volumeMounts:
              - name: data
                mountPath: /bitnami/clickhouse
              - name: tls
                mountPath: /etc/pki/tls
              - name: client-config
                mountPath: /etc/clickhouse-client
              - name: config
                mountPath: /opt/bitnami/clickhouse/etc/conf.d
        - name: incremental
          compatibleMethod: full
          actionSetName: clickhouse-incremental-backup
          targetVolumes:
            volumeMounts:
              - name: data
                mountPath: /bitnami/clickhouse
              - name: tls
                mountPath: /etc/pki/tls
              - name: client-config
                mountPath: /etc/clickhouse-client
              - name: config
                mountPath: /opt/bitnami/clickhouse/etc/conf.d
      schedules:
        - backupMethod: full
          enabled: false
          cronExpression: "0 18 * * *"
          retentionPeriod: 8d
        - backupMethod: incremental
          enabled: false
          cronExpression: "0 18 * * *"
          retentionPeriod: 7d