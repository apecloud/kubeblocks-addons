apiVersion: apps.kubeblocks.io/v1
kind: ComponentVersion
metadata:
  name: clickhouse
  labels:
    {{- include "clickhouse.labels" . | nindent 4 }}
  annotations:
    {{- include "clickhouse.apiVersion" . | nindent 4 }}
spec:
  compatibilityRules:
    - releases:
      {{- range .Values.clickhouseVersions }}
      - {{ .version }}
      {{- end }}
      compDefs:
        - {{ include "clickhouse.cmpdRegexpPattern" . }}
    - releases:
      {{- range .Values.clickhouseVersions }}
        - {{ .version }}
      {{- end }}
      compDefs:
        - {{ include "clickhouse-keeper.cmpdRegexpPattern" . }}
  releases:
  {{- range .Values.clickhouseVersions }}
    - name: {{ .version }}
      serviceVersion: {{ .version }}
      images:
        copy-tools: {{ include "busybox.image" $ }}
        clickhouse: {{ include "clickhouse.repository" $ }}:{{ .imageTag }}
        role-probe: {{ include "clickhouse.repository" $ }}:{{ .imageTag }}
        switchover: {{ include "clickhouse.repository" $ }}:{{ .imageTag }}
        memberJoin: {{ include "clickhouse.repository" $ }}:{{ .imageTag }}
        memberLeave: {{ include "clickhouse.repository" $ }}:{{ .imageTag }}
  {{- end }}