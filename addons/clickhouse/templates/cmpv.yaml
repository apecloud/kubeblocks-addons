apiVersion: apps.kubeblocks.io/v1alpha1
kind: ComponentVersion
metadata:
  name: clickhouse
  labels:
      {{- include "clickhouse.labels" . | nindent 4 }}
spec:
  compatibilityRules:
    - releases:
        - 24.8.3
        - 22.9.4
        - 22.3.18
        - 22.3.20
        - 25.4.4
      compDefs:
        - clickhouse-24
  releases:
    - name: 25.4.4
      serviceVersion: 25.4.4
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:25.4.4-debian-12-r1
    - name: 24.8.3
      serviceVersion: 24.8.3
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:24.8.3-debian-12-r1
    - name: 22.9.4
      serviceVersion: 22.9.4
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:22.9.4-debian-11-r1
    - name: 22.3.18
      serviceVersion: 22.3.18
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:22.3.18-debian-11-r3
    - name: 22.3.20
      serviceVersion: 22.3.20
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:22.3.20

---
apiVersion: apps.kubeblocks.io/v1alpha1
kind: ComponentVersion
metadata:
  name: ch-keeper
  labels:
      {{- include "clickhouse.labels" . | nindent 4 }}
spec:
  compatibilityRules:
    - releases:
        - 24.8.3
        - 22.9.4
        - 22.3.18
        - 22.3.20
        - 25.4.4
      compDefs:
        - ch-keeper-24
  releases:
    - name: 25.4.4
      serviceVersion: 25.4.4
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:25.4.4-debian-12-r1
        copy-tools: {{ .Values.busyboxImage.registry | default ( .Values.image.registry | default "docker.io" ) }}/{{ .Values.busyboxImage.repository }}:{{ .Values.busyboxImage.tag }}
    - name: 24.8.3
      serviceVersion: 24.8.3
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:24.8.3-debian-12-r1
        copy-tools: {{ .Values.busyboxImage.registry | default ( .Values.image.registry | default "docker.io" ) }}/{{ .Values.busyboxImage.repository }}:{{ .Values.busyboxImage.tag }}
    - name: 22.9.4
      serviceVersion: 22.9.4
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:22.9.4-debian-11-r1
        copy-tools: {{ .Values.busyboxImage.registry | default ( .Values.image.registry | default "docker.io" ) }}/{{ .Values.busyboxImage.repository }}:{{ .Values.busyboxImage.tag }}
    - name: 22.3.18
      serviceVersion: 22.3.18
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:22.3.18-debian-11-r3
        copy-tools: {{ .Values.busyboxImage.registry | default ( .Values.image.registry | default "docker.io" ) }}/{{ .Values.busyboxImage.repository }}:{{ .Values.busyboxImage.tag }}
    - name: 22.3.20
      serviceVersion: 22.3.20
      images:
        clickhouse: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository | default "bitnami/clickhouse" }}:22.3.20
        copy-tools: {{ .Values.busyboxImage.registry | default ( .Values.image.registry | default "docker.io" ) }}/{{ .Values.busyboxImage.repository }}:{{ .Values.busyboxImage.tag }}
