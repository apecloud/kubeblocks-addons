apiVersion: apps.kubeblocks.io/v1
kind: ComponentVersion
metadata:
  name: etcd
  labels:
    {{- include "etcd.labels" . | nindent 4 }}
  annotations:
    {{- include "etcd.apiVersion" . | nindent 4 }}
spec:
  compatibilityRules:
    - releases:
      {{- range .Values.etcdVersions }}
      - {{ .version }}
      {{- end }}
      compDefs:
        - {{ include "etcd3.cmpdRegexpPattern" . }}
  releases:
  {{- range .Values.etcdVersions }}
    - name: {{ .version }}
      serviceVersion: {{ .version }}
      images:
        inject-bash: {{ include "bashBusybox.image" $ }}
        etcd: {{ include "etcd.repository" $ }}:{{ .imageTag }}
        memberJoin: {{ include "etcd.repository" $ }}:{{ .imageTag }}
        memberLeave: {{ include "etcd.repository" $ }}:{{ .imageTag }}
        roleProbe: {{ include "etcd.repository" $ }}:{{ .imageTag }}
        switchover: {{ include "etcd.repository" $ }}:{{ .imageTag }}
        dataDump: {{ include "etcd.repository" $ }}:{{ .imageTag }}
        dataLoad: {{ include "etcd.repository" $ }}:{{ .imageTag }}
  {{- end }}
