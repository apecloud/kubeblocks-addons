apiVersion: apps.kubeblocks.io/v1alpha1
kind: OpsDefinition
metadata:
  name: mogdb-switchover
spec:
  varsRef:
    podSelectionStrategy: Available
    vars:
      - name: TARGET_POD_IP
        valueFrom:
          envVarRef:
            envName: KB_POD_IP
  parametersSchema:
    openAPIV3Schema:
      properties:
        primary:
          description: "old primary instance name(pod Name)."
          type: string
        candidate:
          description: |
            candidate instance name(pod Name). if candidate is not empty, will promote it to primary. 
            otherwise promote a randomly selected pod to primary.
          type: string
      type: object
  jobSpec:
    backoffLimit: 0
    template:
      spec:
        containers:
          - name: switchover
            image: docker.io/apecloud/kubeblocks-tools:latest
            imagePullPolicy: IfNotPresent
            command:
              - sh
              - /scripts/switchover.sh
            volumeMounts:
              - name: scripts
                mountPath: /scripts
        volumes:
          - name: scripts
            configMap:
              name: mogdb-scripts
              defaultMode: 0777