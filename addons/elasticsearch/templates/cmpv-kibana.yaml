# Kibana should be configured to run against an Elasticsearch node of the same version. This is the officially supported configuration.
#
# Running different major version releases of Kibana and Elasticsearch (e.g. Kibana 5.x and Elasticsearch 2.x) is not supported, nor is running a minor version of Kibana that is newer than the version of Elasticsearch (e.g. Kibana 5.1 and Elasticsearch 5.0).
#
# Running a minor version of Elasticsearch that is higher than Kibana will generally work in order to facilitate an upgrade process where Elasticsearch is upgraded first (e.g. Kibana 5.0 and Elasticsearch 5.1). In this configuration, a warning will be logged on Kibana server startup, so it's only meant to be temporary until Kibana is upgraded to the same version as Elasticsearch.
#
# Running different patch version releases of Kibana and Elasticsearch (e.g. Kibana 5.0.0 and Elasticsearch 5.0.1) is generally supported, though we encourage users to run the same versions of Kibana and Elasticsearch down to the patch version.
{{ $imageRegistry := .Values.image.registry | default "docker.io" -}}
apiVersion: apps.kubeblocks.io/v1alpha1
kind: ComponentVersion
metadata:
  name: kibana
  labels:
    {{- include "elasticsearch.labels" . | nindent 4 }}
spec:
  compatibilityRules:
{{- range .Values.kibanaVersions }}
  - compDefs:
    - {{ .componentDef }}
    releases:
{{- range .minors }}
      - {{ index . 0 }}
{{- end }}
{{- end }}
  releases:
{{- range .Values.kibanaVersions }}
{{- range .minors }}
{{- if not (index . 3) }}
  - name: {{ index . 0 }}
    serviceVersion: {{ index . 1 }}
    images:
      kibana: {{ $imageRegistry }}/{{ $.Values.image.kibana.repository }}:{{ index . 2 }}
{{- end }}
{{- end }}
{{- end }}
