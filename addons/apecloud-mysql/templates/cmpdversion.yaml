apiVersion: apps.kubeblocks.io/v1alpha1
kind: ComponentVersion
metadata:
  name: apecloud-mysql
  labels:
    {{- include "apecloud-mysql.labels" . | nindent 4 }}
spec:
  releases:
  - name: apecloud-mysql-8.0.30
    serviceVersion: "8.0.30"
    images:
      mysql: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository }}:{{ .Values.image.tag }}
      mysql-exporter: {{ .Values.metrics.image.registry | default .Values.image.registry }}/{{ .Values.metrics.image.repository }}:{{ default .Values.metrics.image.tag }}
      vtablet: {{ .Values.wesqlscale.image.registry | default "docker.io" }}/{{ .Values.wesqlscale.image.repository }}:{{ .Values.wesqlscale.image.tag }}
  - name: apecloud-mysql-auditlog-8.0.30
    serviceVersion: "8.0.30"
    images:
      init-data: {{ .Values.image.registry | default "docker.io" }}/apecloud/mysql_audit_log:8.0.33
      mysql: {{ .Values.image.registry | default "docker.io" }}/{{ .Values.image.repository }}:{{ .Values.image.tag }}
      mysql-exporter: {{ .Values.metrics.image.registry | default .Values.image.registry }}/{{ .Values.metrics.image.repository }}:{{ default .Values.metrics.image.tag }}
      vtablet: {{ .Values.wesqlscale.image.registry | default "docker.io" }}/{{ .Values.wesqlscale.image.repository }}:{{ .Values.wesqlscale.image.tag }}
  compatibilityRules:
  - releases: [apecloud-mysql-8.0.30]
    compDefs: [apecloud-mysql]
  - releases: [apecloud-mysql-auditlog-8.0.30]
    compDefs: [apecloud-mysql-auditlog]
---
apiVersion: apps.kubeblocks.io/v1alpha1
kind: ComponentVersion
metadata:
  name: wescale-vtcontroller
  labels:
    {{- include "apecloud-mysql.labels" . | nindent 4 }}
spec:
  releases:
  - name: vtcontroller-0.2.7
    serviceVersion: "0.2.7"
    images:
      vtconsensus: &wescale  {{ .Values.wesqlscale.image.registry | default "docker.io" }}/{{ .Values.wesqlscale.image.repository }}:{{ .Values.wesqlscale.image.tag }}
      etcd: *wescale
      vtctld: *wescale
  compatibilityRules:
  - releases: [vtcontroller-0.2.7]
    compDefs: [vtcontroller]
---
apiVersion: apps.kubeblocks.io/v1alpha1
kind: ComponentVersion
metadata:
  name: wescale-vtgate
  labels:
    {{- include "apecloud-mysql.labels" . | nindent 4 }}
spec:
  releases:
  - name: vtgate-0.2.7
    serviceVersion: "0.2.7"
    images:
      # wait-vtctld-ready: {{ .Values.wesqlscale.registry | default "docker.io" }}/busybox:1.35
      vtgate:
        {{ .Values.wesqlscale.image.registry | default "docker.io" }}/{{ .Values.wesqlscale.image.repository }}:{{ .Values.wesqlscale.image.tag }}
  compatibilityRules:
  - releases: [vtgate-0.2.7]
    compDefs: [vtgate]