apiVersion: apps.kubeblocks.io/v1
kind: ComponentDefinition
metadata:
  annotations:
    apps.kubeblocks.io/skip-immutable-check: "true"
    {{- include "starrocks.apiVersion" . | nindent 4 }}
  name: {{ include "fe-shared-nothing.componentDefName" . }}
  labels:
    {{- include "starrocks.labels" . | nindent 4 }}
spec:
  provider: kubeblocks
  description: A StarRocks FE v3.2.2 component definition for Kubernetes
  {{- include "fe.commonDef" . | nindent 2 }}
  configs:
    - name: fe-cm
      template: {{ include "fe-shared-nothing.configTemplate" . }}
      namespace: {{ .Release.Namespace }}
      volumeName: fe-cm
      externalManaged: true
  vars:
  - name: FE_DISCOVERY_SVC_NAME
    valueFrom:
      serviceVarRef:
        compDef: {{ include "fe-shared-nothing.componentDefName" . }}
        name: fe
        host: Required
  - name: FE_DISCOVERY_ADDR
    value: $(FE_DISCOVERY_SVC_NAME).$(KB_NAMESPACE).svc.{{ .Values.clusterDomain }}
  - name: STARROCKS_USER
    valueFrom:
      credentialVarRef:
        compDef: {{ include "fe-shared-nothing.componentDefName" . }}
        name: root
        optional: false
        username: Required
  - name: STARROCKS_PASSWORD
    valueFrom:
      credentialVarRef:
        compDef: {{ include "fe-shared-nothing.componentDefName" . }}
        name: root
        optional: false
        password: Required
  - name: MYSQL_PWD
    valueFrom:
      credentialVarRef:
        compDef: {{ include "fe-shared-nothing.componentDefName" . }}
        name: root
        optional: false
        password: Required
